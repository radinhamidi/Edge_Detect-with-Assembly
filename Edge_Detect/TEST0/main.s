				PRESERVE8
                THUMB

                AREA    RESET, DATA, READONLY
                EXPORT  __Vectors
__Vectors
				DCD  0x20001000     ; stack pointer value when stack is empty
				DCD  Reset_Handler  ; reset vector

				AREA	myCode, CODE, READONLY

;**********************************************************************
RCC_AHB1ENR		EQU		0x40023830
GPIOA_IDR		EQU		0x40020010
GPIOB_MODER		EQU		0x40020400
GPIOB_ODR		EQU		0x40020414
;**********************************************************************
				ENTRY
Reset_Handler
;INITIALIZING SETTING REGISTERS**********************
		mov32	r1,#RCC_AHB1ENR
		mov32	r0,#0x00100003
		str		r0,[r1]
		
		mov32	r1,#GPIOB_MODER
		mov32	r0,#0x00000284
		str		r0,[r1]
;****************************************************
; You'd want code here to enable GPIOC clock in AHB
;********Waiting for input pin to get High***********
hold
	mov32	r1,#GPIOA_IDR
	mov32	r2,#0x00000001
	ldr		r0,[r1]
	mul		r0,r0,r2
	cmp		r0,#0x0
	bne		start
	b		hold
;****************************************************	
;***algorithm written in robert edge detection form**	
start
	ldr r6,pointer		;data pointer
	ldr r10,respoint	;result pointer
	mov r5,#15			;row counter
	mov r9,#0			;global counter
	mov r8,#37			;Threshold
loop ldrb r0,[r6]
	add r6,r6,#1
	subs r5,r5,#1
	add r9,r9,#1
	beq countrst
	ldrb r1,[r6]
	ldrb r2,[r6,#14]
	ldrb r3,[r6,#15]
	cmp r0,r3
	blmi revers1
	sub r0,r0,r3
	cmp r1,r2
	blmi revers2
	sub r1,r1,r2
	add r4,r0,r1
	cmp r4,r8
	blhs low
	bllo high
	cmp r9,#225
	blo  loop
;******setting output pin High******
	mov32	r1,#GPIOB_ODR
	mov32	r0,#0x00000002
	str		r0,[r1]
;***********************************
inf	b inf

revers1 mov r11,r3
		mov r3,r0
		mov r0,r11
		mov pc,lr

revers2 mov r11,r1
		mov r1,r2
		mov r2,r11
		mov pc,lr

countrst mov r5,#15
	b loop


high mov r7,#0x7f
	strb r7,[r10]
	add r10,r10,#1
	mov pc,lr

low mov r7,#0x00
	strb r7,[r10]  
	add r10,r10,#1
	mov pc,lr
	
	
image		DCB     119,99,111,141,43,0,12,7,0,10,16,15,33,33,31,96,93,108,112,134,58,2,0,9,0,0,14,24,22,22,110,103,103,106,123,120,59,8,0,0,0,3,9,12,15,101,130,111,96,101,122,125,70,10,3,2,0,5,4,9,127,103,101,109,108,114,123,124,76,5,0,4,10,0,7,113,118,119,114,109,119,112,116,135,112,26,0,13,0,3,111,116,118,114,110,112,121,102,110,142,106,26,0,10,0,108,113,116,115,112,128,96,117,124,101,129,118,23,0,17,107,111,115,115,114,116,119,125,114,97,109,123,116,43,10,108,110,114,115,115,113,119,116,116,119,110,113,136,134,56,111,110,113,115,116,124,108,112,120,115,120,124,112,139,142,115,111,113,115,116,110,139,114,94,124,122,104,123,114,132,118,112,113,115,116,119,116,125,120,103,114,126,110,101,110,118,113,91,117,103,113,113,113,114,115,116,116,117,105,104,124,117,94,117,103,112,113,113,114,115,116,116,116,122,108
pointer		DCD 	image
respoint	DCD		result
result		DCB		119,99,111,141,43,0,12,7,0,10,16,15,33,33,31,96,93,108,112,134,58,2,0,9,0,0,14,24,22,22,110,103,103,106,123,120,59,8,0,0,0,3,9,12,15,101,130,111,96,101,122,125,70,10,3,2,0,5,4,9,127,103,101,109,108,114,123,124,76,5,0,4,10,0,7,113,118,119,114,109,119,112,116,135,112,26,0,13,0,3,111,116,118,114,110,112,121,102,110,142,106,26,0,10,0,108,113,116,115,112,128,96,117,124,101,129,118,23,0,17,107,111,115,115,114,116,119,125,114,97,109,123,116,43,10,108,110,114,115,115,113,119,116,116,119,110,113,136,134,56,111,110,113,115,116,124,108,112,120,115,120,124,112,139,142,115,111,113,115,116,110,139,114,94,124,122,104,123,114,132,118,112,113,115,116,119,116,125,120,103,114,126,110,101,110,118,113,91,117,103,113,113,113,114,115,116,116,117,105,104,124,117,94,117,103,112,113,113,114,115,116,116,116,122,108

			END
